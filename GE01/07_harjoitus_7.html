<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

<link rel="icon" href="/master-training-data/favicon.ico" type="image/x-icon">
<link rel="shortcut icon" href="/master-training-data/favicon.ico" type="image/x-icon">

<!-- Based on TemplateMo 553 Xtra Blog: https://templatemo.com/tm-553-xtra-blog -->

<meta name="robots" content="noindex, nofollow" />
<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta property="og:title" content="Harjoitus 7: Pistetyökalu | QGIS-lisäosien kehitys" />
<meta property="og:type" content="book" />





<meta name="author" content="Gispo Suomi Oy" />

<meta name="date" content="2025-10-31" />


<meta name="description" content="Harjoitus 7: Pistetyökalu | QGIS-lisäosien kehitys">

<title>Harjoitus 7: Pistetyökalu | QGIS-lisäosien kehitys</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="custom.css" type="text/css" />

<link href="css/bootstrap.min.css" rel="stylesheet">
<link href="css/hamburgers.css" rel="stylesheet">

</head>

<body>


<div class="main-content">
<!-- special comment to mark beginning of title section for bookdown -->
<!-- bookdown comments must be in this order: title, toc, body -->

<div class="main-content-wrapper">

<div class="row">
<div class="col-sm-12">
<header class="main-toc sidebar" id="sidebar">
<div class="sidebar-wrapper">

<button class="navbar-toggle hamburger hamburger--collapse" id="navbar-toggle"
type="button" onclick="navToggle()" aria-label="Toggle navigation">
<span class="hamburger-box"><span class="hamburger-inner"></span></span>
</button>

<div class="sidebar-title-wrapper">
<img alt="Logo" width="100" src="img/gispo_white_sm.png" class="sidebar-logo">
<div class="sidebar-title"><h1>QGIS-lisäosien kehitys</h1></div>
<div class="abstract-sidebar"><p>Lisäosien kehitys Pythonilla</p></div>
</div>

<nav class="sidebar-nav">
<div id="TOC" class="toc">
<ul>
<li class="has-sub"><a href="index.html#qgis-lisäosien-kehitys">QGIS-lisäosien kehitys</a>
<ul>
<li><a href="index.html#tervetuloa-kurssille">Tervetuloa kurssille!</a></li>
<li><a href="index.html#kurssihakemisto">Kurssihakemisto</a></li>
<li><a href="index.html#lukuohje">Lukuohje</a></li>
<li><a href="index.html#mistä-lisätietoja">Mistä lisätietoja?</a></li>
<li><a href="index.html#virheet">Virheet</a></li>
<li><a href="index.html#lisenssi-ja-oikeudet">Lisenssi ja oikeudet</a></li>
<li><a href="index.html#materiaali-pdf-muodossa">Materiaali PDF-muodossa</a></li>
</ul></li>
<li class="has-sub"><a href="00_harjoitus_0.html#harjoitus-0-python-kertaus">Harjoitus 0: Python-kertaus</a>
<ul>
<li><a href="00_harjoitus_0.html#esivalmistelut">Esivalmistelut</a></li>
<li class="has-sub"><a href="00_harjoitus_0.html#python-perusteita">Python-perusteita</a>
<ul>
<li><a href="00_harjoitus_0.html#komennot">Komennot</a></li>
<li><a href="00_harjoitus_0.html#kommentit">Kommentit</a></li>
<li><a href="00_harjoitus_0.html#luvuilla-laskeminen">Luvuilla laskeminen</a></li>
<li><a href="00_harjoitus_0.html#muuttujat">Muuttujat</a></li>
<li><a href="00_harjoitus_0.html#tyypit">Tyypit</a></li>
<li><a href="00_harjoitus_0.html#ehtolauseet-ja-vertailu">Ehtolauseet ja vertailu</a></li>
<li><a href="00_harjoitus_0.html#funktiot">Funktiot</a></li>
<li><a href="00_harjoitus_0.html#tietorakenteita">Tietorakenteita</a></li>
<li><a href="00_harjoitus_0.html#silmukat-ja-iterointi">Silmukat ja iterointi</a></li>
<li><a href="00_harjoitus_0.html#moduulit">Moduulit</a></li>
<li><a href="00_harjoitus_0.html#oliot">Oliot</a></li>
<li><a href="00_harjoitus_0.html#luokat">Luokat</a></li>
</ul></li>
</ul></li>
<li class="has-sub"><a href="01_harjoitus_1.html#harjoitus-1-python-konsoli">Harjoitus 1: Python-konsoli</a>
<ul>
<li><a href="01_harjoitus_1.html#harjoitusten-rakenne">Harjoitusten rakenne</a></li>
<li><a href="01_harjoitus_1.html#esimerkit">Esimerkit</a></li>
<li><a href="01_harjoitus_1.html#harjoitukset">Harjoitukset</a></li>
<li><a href="01_harjoitus_1.html#harjoitus-1.1">Harjoitus 1.1</a></li>
</ul></li>
<li class="has-sub"><a href="02_harjoitus_2.html#harjoitus-2-pyqgis-perusteet">Harjoitus 2: PyQGIS-perusteet</a>
<ul>
<li><a href="02_harjoitus_2.html#tasojen-käsittely">Tasojen käsittely</a></li>
<li><a href="02_harjoitus_2.html#harjoitus-2.1">Harjoitus 2.1</a></li>
<li><a href="02_harjoitus_2.html#harjoitus-2.2">Harjoitus 2.2</a></li>
<li><a href="02_harjoitus_2.html#harjoitus-2.3">Harjoitus 2.3</a></li>
</ul></li>
<li class="has-sub"><a href="03_harjoitus_3.html#harjoitus-3-tasot-kohteet-ja-geometriat">Harjoitus 3: Tasot, kohteet ja geometriat</a>
<ul>
<li><a href="03_harjoitus_3.html#tasot">Tasot</a></li>
<li><a href="03_harjoitus_3.html#väliaikaisen-tason-luominen">Väliaikaisen tason luominen</a></li>
<li><a href="03_harjoitus_3.html#geometriat">Geometriat</a></li>
<li><a href="03_harjoitus_3.html#harjoitus-3.1">Harjoitus 3.1</a></li>
<li><a href="03_harjoitus_3.html#harjoitus-3.2-etäisyydet">Harjoitus 3.2: Etäisyydet</a></li>
</ul></li>
<li class="has-sub"><a href="04_harjoitus_4.html#harjoitus-4-qt-käyttöliittymät">Harjoitus 4: Qt-käyttöliittymät</a>
<ul>
<li class="has-sub"><a href="04_harjoitus_4.html#qt-käyttöliittymistä">Qt-käyttöliittymistä</a>
<ul>
<li><a href="04_harjoitus_4.html#qwidget">QWidget</a></li>
<li><a href="04_harjoitus_4.html#signaalit-ja-slotit">Signaalit ja slotit</a></li>
</ul></li>
<li><a href="04_harjoitus_4.html#harjoitus-4.1-counter-widget">Harjoitus 4.1: Counter-widget</a></li>
<li><a href="04_harjoitus_4.html#harjoitus-4.2-qgisin-widgetit">Harjoitus 4.2: QGISin widgetit</a></li>
</ul></li>
<li class="has-sub"><a href="05_harjoitus_5.html#harjoitus-5-uuden-lisäosan-luominen">Harjoitus 5: Uuden lisäosan luominen</a>
<ul>
<li><a href="05_harjoitus_5.html#gitin-konfigurointi">Gitin konfigurointi</a></li>
<li><a href="05_harjoitus_5.html#lisäosan-luominen">Lisäosan luominen</a></li>
<li><a href="05_harjoitus_5.html#ensimmäinen-commit">Ensimmäinen commit</a></li>
<li><a href="05_harjoitus_5.html#lisäosan-käyttöönotto">Lisäosan käyttöönotto</a></li>
<li class="has-sub"><a href="05_harjoitus_5.html#lisäosan-rakenne">Lisäosan rakenne</a>
<ul>
<li><a href="05_harjoitus_5.html#tiedosto-plugin.py">Tiedosto: plugin.py</a></li>
<li><a href="05_harjoitus_5.html#tiedosto-__init__.py">Tiedosto: __init__.py</a></li>
</ul></li>
</ul></li>
<li class="has-sub"><a href="06_harjoitus_6.html#harjoitus-6-buffer--työkalu">Harjoitus 6: Buffer- työkalu</a>
<ul>
<li><a href="06_harjoitus_6.html#harjoitus-6.1-käyttöliittymän-suunnittelu">Harjoitus 6.1: Käyttöliittymän suunnittelu</a></li>
<li><a href="06_harjoitus_6.html#harjoitus-6.2-käyttöliittymän-kytkeminen-lisäosaan">Harjoitus 6.2: Käyttöliittymän kytkeminen lisäosaan</a></li>
<li><a href="06_harjoitus_6.html#harjoitus-6.3-työkalun-toiminta">Harjoitus 6.3: Työkalun toiminta</a></li>
<li><a href="06_harjoitus_6.html#harjoitus-6.4-segmentit">Harjoitus 6.4: Segmentit</a></li>
<li><a href="06_harjoitus_6.html#yksikkötestit">Yksikkötestit</a></li>
<li class="has-sub"><a href="06_harjoitus_6.html#harjoitus-6.5-testit">Harjoitus 6.5: Testit</a>
<ul>
<li><a href="06_harjoitus_6.html#harjoitus-6.5.1-käyttöliittymätesti">Harjoitus 6.5.1: Käyttöliittymätesti</a></li>
<li><a href="06_harjoitus_6.html#harjoitus-6.5.2-buffertool-testi">Harjoitus 6.5.2: BufferTool-testi</a></li>
<li><a href="06_harjoitus_6.html#harjoitus-6.5.3-lisää-testejä">Harjoitus 6.5.3: Lisää testejä</a></li>
</ul></li>
<li><a href="06_harjoitus_6.html#mallilisäosa">Mallilisäosa</a></li>
</ul></li>
<li class="has-sub"><a href="07_harjoitus_7.html#harjoitus-7-pistetyökalu">Harjoitus 7: Pistetyökalu</a>
<ul>
<li><a href="07_harjoitus_7.html#harjoitus-7.1-paneelin-lisääminen">Harjoitus 7.1: Paneelin lisääminen</a></li>
<li class="has-sub"><a href="07_harjoitus_7.html#harjoitus-7.2-työkalu">Harjoitus 7.2: Työkalu</a>
<ul>
<li><a href="07_harjoitus_7.html#harjoitus-7.2.1-lisähaaste---nimiöinti">Harjoitus 7.2.1: Lisähaaste - nimiöinti</a></li>
</ul></li>
<li><a href="07_harjoitus_7.html#harjoitus-7.3-testit">Harjoitus 7.3: Testit</a></li>
</ul></li>
<li class="has-sub"><a href="08_harjoitus_8.html#harjoitus-8-prosessointialgoritmi">Harjoitus 8: Prosessointialgoritmi</a>
<ul>
<li class="has-sub"><a href="08_harjoitus_8.html#taustaa">Taustaa</a>
<ul>
<li><a href="08_harjoitus_8.html#prosessointialgoritmin-kutsuminen">Prosessointialgoritmin kutsuminen</a></li>
</ul></li>
<li><a href="08_harjoitus_8.html#algoritmi-lisäosassa">Algoritmi lisäosassa</a></li>
<li><a href="08_harjoitus_8.html#harjoitus-8.1-algoritmin-kirjoitus">Harjoitus 8.1: Algoritmin kirjoitus</a></li>
<li><a href="08_harjoitus_8.html#harjoitus-8.2-testit-algoritmille">Harjoitus 8.2: Testit algoritmille</a></li>
</ul></li>
<li class="has-sub"><a href="09_lisatehtavia_9.html#python-lisätehtäviä">Python-lisätehtäviä</a>
<ul>
<li class="has-sub"><a href="09_lisatehtavia_9.html#aihe-1-listakoosteet">Aihe 1: Listakoosteet</a>
<ul>
<li><a href="09_lisatehtavia_9.html#lisätehtävä-1.1">Lisätehtävä 1.1</a></li>
<li><a href="09_lisatehtavia_9.html#sisäkkäisiä-koosteita">Sisäkkäisiä koosteita</a></li>
</ul></li>
<li class="has-sub"><a href="09_lisatehtavia_9.html#aihe-2-lambda-funktiot">Aihe 2: Lambda-funktiot</a>
<ul>
<li><a href="09_lisatehtavia_9.html#lisätehtävä-2.1">Lisätehtävä 2.1</a></li>
</ul></li>
<li class="has-sub"><a href="09_lisatehtavia_9.html#aihe-3-dekoraattorit">Aihe 3: Dekoraattorit</a>
<ul>
<li><a href="09_lisatehtavia_9.html#lisätehtävä-3.1">Lisätehtävä 3.1</a></li>
<li><a href="09_lisatehtavia_9.html#dekoraattorit-ja-parametrit">Dekoraattorit ja parametrit</a></li>
<li><a href="09_lisatehtavia_9.html#lisätehtävä-3.2">Lisätehtävä 3.2</a></li>
</ul></li>
<li><a href="09_lisatehtavia_9.html#aihe-4-tyypitys">Aihe 4: Tyypitys</a></li>
<li><a href="09_lisatehtavia_9.html#lisätehtävä-4.1">Lisätehtävä 4.1</a></li>
</ul></li>
</ul>
</div>
</nav>
</div>
</header>
</div>
</div>
<div class="row">
<div class="col-sm-12">
<div id="harjoitus-7-pistetyökalu" class="section level1">
<h1>Harjoitus 7: Pistetyökalu</h1>
<p>Harjoituksen tarkoituksena on luoda pistetyökalu, jolla voi luoda koordinaattien
pohjalta pistekohteen. Käyttöliittymässä on alasvetolaatikko pistetasoille
(tasoja, joilla on eri geometriatyyppi ei näytetä ollenkaan).
Jos tasoa ei ole valittu, täytyy käyttäjän valita koordinaattijärjestelmä, ja
tällöin työkalu luo uuden pistetason kyseisellä koordinaattijärjestelmällä.
Tasolle lisätään pistekohde ja tallennetaan sen koordinaatit ‘x’ ja ‘y’-kenttiin.</p>
<p><img src="img/harjoitus_7/image1.gif" /></p>
<p>Jos käyttäjä ei ole valinnut tasoa <em>eikä</em> koordinaattijärjestelmää, lisäosa
näyttää virheen. Jos käyttäjä on valinnut pistetason, koordinaattijärjestelmä-widget
inaktivoituu ja se ei vaikuta lisättävään pisteeseen mitenkään.</p>
<p><img src="img/harjoitus_7/image2.gif" /></p>
<p>Edellisessä harjoituksessa käytiin yksityiskohtaisesti läpi
työkalun toteutus lisäosaan. Tämän harjoituksen on tarkoitus
olla itsenäisempi. Tälle työkalulle luodaan paneelikäyttöliittymä
(QDockWidget), joten käydään aluksi sen luominen läpi pääpiirteittäin.</p>
<div id="harjoitus-7.1-paneelin-lisääminen" class="section level2">
<h2>Harjoitus 7.1: Paneelin lisääminen</h2>
<p>Avaa Qt Designer ja valitse <strong>New Form</strong> -dialogissa <strong>Widgets</strong>-valikon
alta QDockWidget. Vaihda widgetin nimeksi <strong>PointToolDockWidget</strong>.
Luo kuvan mukainen käyttöliittymä, jossa on käytetty seuraavia
widgettejä:</p>
<p><img src="img/harjoitus_7/image3.png" /></p>
<ul>
<li>X: QgsDoubleSpinBox (nimi: xSpinBox)</li>
<li>Y: QgsDoubleSpinBox (nimi: ySpinBox)</li>
<li>QgsProjectionSelectionWidget (nimi: crsWidget)</li>
<li>QgsMapLayerComboBox (nimi: layerComboBox)</li>
<li>QPushButton (nimi: createPushButton)</li>
</ul>
<p>Tallenna käyttöliittymä polkuun <code>test-plugin/testplugin/resources/ui/point_tool.ui</code>.
Halutessasi voit tallentaa ikonin työkalulle polkuun <code>test-plugin/testplugin/resources/icons/point_tool.png</code>.
Voit ladata esimerkiksi tämän kuvan: <img src="img/harjoitus_7/image4.png" /></p>
<p>Luo uusi tiedosto <code>test-plugin/testplugin/ui/point_tool_dockwidget.py</code> ja lisää koodi:</p>
<div class="code-box">
<div class="sourceCode" id="cb154"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb154-1"><a href="07_harjoitus_7.html#cb154-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> logging</span>
<span id="cb154-2"><a href="07_harjoitus_7.html#cb154-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> Optional</span>
<span id="cb154-3"><a href="07_harjoitus_7.html#cb154-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-4"><a href="07_harjoitus_7.html#cb154-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> qgis.PyQt.QtCore <span class="im">import</span> pyqtSignal</span>
<span id="cb154-5"><a href="07_harjoitus_7.html#cb154-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-6"><a href="07_harjoitus_7.html#cb154-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> testplugin.core.pointtool <span class="im">import</span> PointTool</span>
<span id="cb154-7"><a href="07_harjoitus_7.html#cb154-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-8"><a href="07_harjoitus_7.html#cb154-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> qgis.PyQt.QtWidgets <span class="im">import</span> (</span>
<span id="cb154-9"><a href="07_harjoitus_7.html#cb154-9" aria-hidden="true" tabindex="-1"></a>    QDockWidget,</span>
<span id="cb154-10"><a href="07_harjoitus_7.html#cb154-10" aria-hidden="true" tabindex="-1"></a>    QWidget,</span>
<span id="cb154-11"><a href="07_harjoitus_7.html#cb154-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb154-12"><a href="07_harjoitus_7.html#cb154-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> testplugin.qgis_plugin_tools.tools.custom_logging <span class="im">import</span> bar_msg</span>
<span id="cb154-13"><a href="07_harjoitus_7.html#cb154-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> testplugin.qgis_plugin_tools.tools.decorations <span class="im">import</span> log_if_fails</span>
<span id="cb154-14"><a href="07_harjoitus_7.html#cb154-14" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> testplugin.qgis_plugin_tools.tools.resources <span class="im">import</span> load_ui, plugin_name</span>
<span id="cb154-15"><a href="07_harjoitus_7.html#cb154-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-16"><a href="07_harjoitus_7.html#cb154-16" aria-hidden="true" tabindex="-1"></a>FORM_CLASS: QWidget <span class="op">=</span> load_ui(<span class="st">&quot;point_tool.ui&quot;</span>)</span>
<span id="cb154-17"><a href="07_harjoitus_7.html#cb154-17" aria-hidden="true" tabindex="-1"></a>LOGGER <span class="op">=</span> logging.getLogger(plugin_name())</span>
<span id="cb154-18"><a href="07_harjoitus_7.html#cb154-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-19"><a href="07_harjoitus_7.html#cb154-19" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> PointToolDockWidget(QDockWidget, FORM_CLASS):</span>
<span id="cb154-20"><a href="07_harjoitus_7.html#cb154-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-21"><a href="07_harjoitus_7.html#cb154-21" aria-hidden="true" tabindex="-1"></a>    closingPlugin <span class="op">=</span> pyqtSignal()</span>
<span id="cb154-22"><a href="07_harjoitus_7.html#cb154-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-23"><a href="07_harjoitus_7.html#cb154-23" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, iface, parent<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb154-24"><a href="07_harjoitus_7.html#cb154-24" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Constructor.&quot;&quot;&quot;</span></span>
<span id="cb154-25"><a href="07_harjoitus_7.html#cb154-25" aria-hidden="true" tabindex="-1"></a>        <span class="bu">super</span>(PointToolDockWidget, <span class="va">self</span>).<span class="fu">__init__</span>(parent)</span>
<span id="cb154-26"><a href="07_harjoitus_7.html#cb154-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-27"><a href="07_harjoitus_7.html#cb154-27" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.setupUi(<span class="va">self</span>)</span>
<span id="cb154-28"><a href="07_harjoitus_7.html#cb154-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-29"><a href="07_harjoitus_7.html#cb154-29" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> close_event(<span class="va">self</span>, event):</span>
<span id="cb154-30"><a href="07_harjoitus_7.html#cb154-30" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.closingPlugin.emit()</span>
<span id="cb154-31"><a href="07_harjoitus_7.html#cb154-31" aria-hidden="true" tabindex="-1"></a>        event.accept()</span></code></pre></div>
</div>
<p>Avaa seuraavaksi <code>test-plugin/testplugin/plugin.py</code> ja tee seuraavat
muutokset:</p>
<p>Muokkaa importteja:</p>
<p>Koodissa pitäisi olla import jo QCoreApplicationille ja QTranslatorille.
Lisää joukkoon Qt.</p>
<div class="code-box">
<div class="sourceCode" id="cb155"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb155-1"><a href="07_harjoitus_7.html#cb155-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> qgis.PyQt.QtCore <span class="im">import</span> Qt, QCoreApplication, QTranslator</span></code></pre></div>
</div>
<p>Koodissa pitäisi olla import jo plugin_namelle.
Lisää joukkoon resources_path.</p>
<div class="code-box">
<div class="sourceCode" id="cb156"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb156-1"><a href="07_harjoitus_7.html#cb156-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> testplugin.qgis_plugin_tools.tools.resources <span class="im">import</span> plugin_name, resources_path</span></code></pre></div>
</div>
<p>Importoi äsken luotu dockwidget-luokka.</p>
<div class="code-box">
<div class="sourceCode" id="cb157"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb157-1"><a href="07_harjoitus_7.html#cb157-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> testplugin.ui.point_tool_dockwidget <span class="im">import</span> PointToolDockWidget</span></code></pre></div>
</div>
<p>Seuraavaksi muokkaa <strong>Plugin</strong>-luokan konstruktoria (<code>__init__</code>-metodi).
Lisää rivit:</p>
<div class="code-box">
<div class="sourceCode" id="cb158"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb158-1"><a href="07_harjoitus_7.html#cb158-1" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.dockwidget <span class="op">=</span> PointToolDockWidget(iface)</span>
<span id="cb158-2"><a href="07_harjoitus_7.html#cb158-2" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.pluginIsActive <span class="op">=</span> <span class="va">False</span></span></code></pre></div>
</div>
<p>Lisää <code>initGui()</code>-metodiin:</p>
<div class="code-box">
<div class="sourceCode" id="cb159"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb159-1"><a href="07_harjoitus_7.html#cb159-1" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.add_action(</span>
<span id="cb159-2"><a href="07_harjoitus_7.html#cb159-2" aria-hidden="true" tabindex="-1"></a>            resources_path(<span class="st">&quot;icons/point_tool.png&quot;</span>),</span>
<span id="cb159-3"><a href="07_harjoitus_7.html#cb159-3" aria-hidden="true" tabindex="-1"></a>            text<span class="op">=</span>tr(<span class="st">&quot;Point Tool&quot;</span>),</span>
<span id="cb159-4"><a href="07_harjoitus_7.html#cb159-4" aria-hidden="true" tabindex="-1"></a>            callback<span class="op">=</span><span class="va">self</span>.open_point_tool,</span>
<span id="cb159-5"><a href="07_harjoitus_7.html#cb159-5" aria-hidden="true" tabindex="-1"></a>            parent<span class="op">=</span>iface.mainWindow(),</span>
<span id="cb159-6"><a href="07_harjoitus_7.html#cb159-6" aria-hidden="true" tabindex="-1"></a>        )</span></code></pre></div>
</div>
<p>Lisää <code>onClosePlugin()</code>-metodiin:</p>
<div class="code-box">
<div class="sourceCode" id="cb160"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb160-1"><a href="07_harjoitus_7.html#cb160-1" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.dockwidget.closingPlugin.disconnect(<span class="va">self</span>.onClosePlugin)</span>
<span id="cb160-2"><a href="07_harjoitus_7.html#cb160-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-3"><a href="07_harjoitus_7.html#cb160-3" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.pluginIsActive <span class="op">=</span> <span class="va">False</span></span></code></pre></div>
</div>
<p>Lisää uusi metodi <code>open_point_tool()</code>:</p>
<div class="code-box">
<div class="sourceCode" id="cb161"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb161-1"><a href="07_harjoitus_7.html#cb161-1" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> open_point_tool(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb161-2"><a href="07_harjoitus_7.html#cb161-2" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Opens point tool dock widget&quot;&quot;&quot;</span></span>
<span id="cb161-3"><a href="07_harjoitus_7.html#cb161-3" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.pluginIsActive:</span>
<span id="cb161-4"><a href="07_harjoitus_7.html#cb161-4" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.pluginIsActive <span class="op">=</span> <span class="va">True</span></span>
<span id="cb161-5"><a href="07_harjoitus_7.html#cb161-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-6"><a href="07_harjoitus_7.html#cb161-6" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.dockwidget.closingPlugin.<span class="ex">connect</span>(<span class="va">self</span>.onClosePlugin)</span>
<span id="cb161-7"><a href="07_harjoitus_7.html#cb161-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-8"><a href="07_harjoitus_7.html#cb161-8" aria-hidden="true" tabindex="-1"></a>            iface.addDockWidget(Qt.LeftDockWidgetArea, <span class="va">self</span>.dockwidget)</span>
<span id="cb161-9"><a href="07_harjoitus_7.html#cb161-9" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.dockwidget.show()</span></code></pre></div>
</div>
<p>Voit myös luoda jo valmiiksi uuden tiedoston <strong>core</strong>en
<code>test-plugin/testplugin/core/pointtool.py</code></p>
<div class="code-box">
<div class="sourceCode" id="cb162"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb162-1"><a href="07_harjoitus_7.html#cb162-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> testplugin.core.exceptions <span class="im">import</span> PointToolException</span>
<span id="cb162-2"><a href="07_harjoitus_7.html#cb162-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-3"><a href="07_harjoitus_7.html#cb162-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-4"><a href="07_harjoitus_7.html#cb162-4" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> PointTool:</span>
<span id="cb162-5"><a href="07_harjoitus_7.html#cb162-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">pass</span></span></code></pre></div>
</div>
<p>Ja lisätä <code>test-plugin/testplugin/core/exceptions.py</code>-tiedostoon:</p>
<div class="code-box">
<div class="sourceCode" id="cb163"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb163-1"><a href="07_harjoitus_7.html#cb163-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> PointToolException(QgsPluginException):</span>
<span id="cb163-2"><a href="07_harjoitus_7.html#cb163-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">pass</span></span></code></pre></div>
</div>
<p>Päivitä plugin. Työkalua klikatessa QGIS-ikkunan vasempaan reunaan
pitäisi avautua uusi paneeli.</p>
</div>
<div id="harjoitus-7.2-työkalu" class="section level2">
<h2>Harjoitus 7.2: Työkalu</h2>
<p>Seuraavaksi lisää lisäosalle kuvatun mukainen toiminnallisuus.
Tarvittaessa kysy apua kouluttajalta tai katso apua mallilisäosasta:</p>
<p><a href="https://github.com/GispoCoding/pyqgis-training-sample-plugin/blob/feature-2/sampleplugin/plugin.py">test-plugin/testplugin/plugin.py</a><br />
<a href="https://github.com/GispoCoding/pyqgis-training-sample-plugin/blob/feature-2/sampleplugin/ui/point_tool_dockwidget.py">test-plugin/testplugin/ui/point_tool_dockwidget.py</a><br />
<a href="https://github.com/GispoCoding/pyqgis-training-sample-plugin/blob/feature-2/sampleplugin/resources/ui/point_tool.ui">test-plugin/testplugin/resources/ui/point_tool.ui</a><br />
<a href="https://github.com/GispoCoding/pyqgis-training-sample-plugin/blob/c019b85ed7c7bb66b799f633e139d790f3ab21d0/sampleplugin/core/pointtool.py">test-plugin/testplugin/core/pointtool.py</a><br />
<a href="https://github.com/GispoCoding/pyqgis-training-sample-plugin/blob/feature-2/sampleplugin/core/exceptions.py">test-plugin/testplugin/core/exceptions.py</a><br />
</p>
<div id="harjoitus-7.2.1-lisähaaste---nimiöinti" class="section level3">
<h3>Harjoitus 7.2.1: Lisähaaste - nimiöinti</h3>
<p>Kun työkalu lisää uuden taso, määritä tasolle nimiönti joka
piirtää kartalle niiden x ja y koordinaatit:</p>
<p><img src="img/harjoitus_7/image5.png" /></p>
</div>
</div>
<div id="harjoitus-7.3-testit" class="section level2">
<h2>Harjoitus 7.3: Testit</h2>
<p>Luo uusi tiedosto <code>test-plugin/tests/test_point_tool.py</code>.
Kirjoita kaksi testiä:</p>
<ul>
<li><code>test_create_new_point_layer()</code></li>
<li><code>test_add_point_to_layer()</code></li>
</ul>
<p>Toisessa testissä nimien mukaisesti luodaan piste ilman valittua
pistetasoa, jolloin työkalun tulisi luoda uusi pistetaso.
Toisessa lisätään pisteitä jo olemassa olevalle pistetasolle.</p>
<p><a href="https://github.com/GispoCoding/pyqgis-training-sample-plugin/blob/feature-2-tests/tests/test_point_tool.py">test-plugin/tests/test_point_tool.py</a></p>

</div>
</div>
<p style="text-align: center;">
<a href="06_harjoitus_6.html"><button class="btn btn-default">Previous</button></a>
<a href="08_harjoitus_8.html"><button class="btn btn-default">Next</button></a>
</p>
</div>
</div>

<footer class="footer text-center">

<div class="footer-container text-center">

<div class="footer-info">
<h5 class="footer-title">QGIS-lisäosien kehitys</h5>
<span class="footer-version">v2025-10-31</span>
<div class="license"><img src="img/by-nd.svg" width="80px" alt="CC-BY-ND"></div>
</div>

<div class="footer-info">
<h5 class="footer-title footer-company">Gispo Suomi Oy.
<span class="footer-copyright-year">© 2025</span></h5>
<span class="footer-contact-info">Kyllikinportti 2
<br>00240 Helsinki, Finland
<br>info@gispo.fi
</span>
</div>

</div>
</div>
</footer>
</div>


<script src="js/nav-script.js"></script>
<script src="js/answer-key.js"></script>

</body>
</html>
