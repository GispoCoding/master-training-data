<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

<link rel="icon" href="/master-training-data/favicon.ico" type="image/x-icon">
<link rel="shortcut icon" href="/master-training-data/favicon.ico" type="image/x-icon">

<!-- Based on TemplateMo 553 Xtra Blog: https://templatemo.com/tm-553-xtra-blog -->

<meta name="robots" content="noindex, nofollow" />
<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta property="og:title" content="Harjoitus 8: SQL-kyselyt | QGIS-koulutus Kuopion vedelle" />
<meta property="og:type" content="book" />





<meta name="author" content="Gispo Oy." />

<meta name="date" content="2025-10-31" />


<meta name="description" content="Harjoitus 8: SQL-kyselyt | QGIS-koulutus Kuopion vedelle">

<title>Harjoitus 8: SQL-kyselyt | QGIS-koulutus Kuopion vedelle</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="custom.css" type="text/css" />

<link href="css/bootstrap.min.css" rel="stylesheet">
<link href="css/hamburgers.css" rel="stylesheet">

</head>

<body>


<div class="main-content">
<!-- special comment to mark beginning of title section for bookdown -->
<!-- bookdown comments must be in this order: title, toc, body -->

<div class="main-content-wrapper">

<div class="row">
<div class="col-sm-12">
<header class="main-toc sidebar" id="sidebar">
<div class="sidebar-wrapper">

<button class="navbar-toggle hamburger hamburger--collapse" id="navbar-toggle"
type="button" onclick="navToggle()" aria-label="Toggle navigation">
<span class="hamburger-box"><span class="hamburger-inner"></span></span>
</button>

<div class="sidebar-title-wrapper">
<img alt="Logo" width="100" src="img/gispo_white_sm.png" class="sidebar-logo">
<div class="sidebar-title"><h1>QGIS-koulutus Kuopion vedelle</h1></div>
<div class="abstract-sidebar"><p>Tämä on QGIS-koulutus joka on räätälöity Kuopion Veden työntekijöille</p></div>
</div>

<nav class="sidebar-nav">
<div id="TOC" class="toc">
<ul>
<li class="has-sub"><a href="index.html#qgis-koulutus-kuopion-vedelle">QGIS-koulutus Kuopion vedelle</a>
<ul>
<li><a href="index.html#kurssimateriaalien-lataaminen">Kurssimateriaalien lataaminen</a></li>
<li><a href="index.html#lukuohje">Lukuohje</a></li>
<li><a href="index.html#mistä-lisätietoja">Mistä lisätietoja?</a></li>
<li><a href="index.html#virheet">Virheet</a></li>
<li><a href="index.html#lisenssi-ja-oikeudet">Lisenssi ja oikeudet</a></li>
</ul></li>
<li class="has-sub"><a href="01_harjoitus_1.html#harjoitus-1-qgis-käyttöliittymä-ja-perustoiminnot-ja-cad-aineistot-qgisissä">Harjoitus 1: QGIS käyttöliittymä ja perustoiminnot ja CAD-aineistot QGISissä</a>
<ul>
<li><a href="01_harjoitus_1.html#kurssimateriaalien-lataus">Kurssimateriaalien lataus</a></li>
<li><a href="01_harjoitus_1.html#qgisin-käyttöliittymä">QGISin käyttöliittymä</a></li>
<li><a href="01_harjoitus_1.html#qgis-käyttöliittymän-osat">QGIS-käyttöliittymän osat</a></li>
<li class="has-sub"><a href="01_harjoitus_1.html#kokeile-itse">Kokeile itse</a>
<ul>
<li><a href="01_harjoitus_1.html#attribuuttitaulu">Attribuuttitaulu</a></li>
</ul></li>
</ul></li>
<li class="has-sub"><a href="01_harjoitus_1.html#cad-aineistot-qgisissä">CAD-aineistot QGISissä</a>
<ul>
<li><a href="01_harjoitus_1.html#cad-aineiston-tuonti">CAD-aineiston tuonti</a></li>
<li><a href="01_harjoitus_1.html#erilaiset-cad-aineistot">Erilaiset CAD-aineistot</a></li>
<li><a href="01_harjoitus_1.html#paikkatietoaineiston-vienti-cad-muotoon">Paikkatietoaineiston vienti CAD-muotoon</a></li>
</ul></li>
<li class="has-sub"><a href="02_harjoitus_2.html#harjoitus-2-kuopion-veden-rajapinta-aineistot-ja-paikkatietoaineistojen-haku-rajapinnoilta">Harjoitus 2: Kuopion veden rajapinta-aineistot ja paikkatietoaineistojen haku rajapinnoilta</a>
<ul>
<li><a href="02_harjoitus_2.html#harjoituksen-sisältö">Harjoituksen sisältö</a></li>
<li><a href="02_harjoitus_2.html#harjoituksen-tavoite">Harjoituksen tavoite</a></li>
<li><a href="02_harjoitus_2.html#valmistautuminen">Valmistautuminen</a></li>
<li><a href="02_harjoitus_2.html#wms-palvelun-lisääminen">WMS-palvelun lisääminen</a></li>
<li><a href="02_harjoitus_2.html#wfs-palvelun-lisääminen">WFS-palvelun lisääminen</a></li>
<li><a href="02_harjoitus_2.html#wfs-rajapintapalvelun-kysely-ja-suodatus-sql-lausekkeella">WFS-rajapintapalvelun kysely ja suodatus SQL-lausekkeella</a></li>
</ul></li>
<li class="has-sub"><a href="03_harjoitus_3.html#harjoitus-3-paikkatietoaineiston-visualisointi">Harjoitus 3: Paikkatietoaineiston visualisointi</a>
<ul>
<li><a href="03_harjoitus_3.html#harjoituksen-sisältö-1">Harjoituksen sisältö</a></li>
<li><a href="03_harjoitus_3.html#harjoituksen-tavoite-1">Harjoituksen tavoite</a></li>
<li><a href="03_harjoitus_3.html#valmistautuminen-1">Valmistautuminen</a></li>
<li><a href="03_harjoitus_3.html#vektoriaineistojen-visualisointi">Vektoriaineistojen visualisointi</a></li>
<li><a href="03_harjoitus_3.html#viiva--ja-monikulmioaineiston-visualisointi">Viiva- ja monikulmioaineiston visualisointi</a></li>
<li><a href="03_harjoitus_3.html#lisätehtävä-monikulmioaineiston-edistynyt-visualisointi">Lisätehtävä: Monikulmioaineiston edistynyt visualisointi</a></li>
</ul></li>
<li class="has-sub"><a href="04_harjoitus_4.html#harjoitus-4-paikkatietoaineiston-nimiöinti-ja-luokittelu">Harjoitus 4: Paikkatietoaineiston nimiöinti ja luokittelu</a>
<ul>
<li><a href="04_harjoitus_4.html#harjoituksen-sisältö-2">Harjoituksen sisältö</a></li>
<li><a href="04_harjoitus_4.html#harjoituksen-tavoite-2">Harjoituksen tavoite</a></li>
<li><a href="04_harjoitus_4.html#valmistautuminen-2">Valmistautuminen</a></li>
<li><a href="04_harjoitus_4.html#nimiöt">Nimiöt</a></li>
<li><a href="04_harjoitus_4.html#nimiöiden-tyyli--ja-yleisasetukset">Nimiöiden tyyli- ja yleisasetukset</a></li>
<li><a href="04_harjoitus_4.html#nimiön-tekstityyli">Nimiön tekstityyli</a></li>
<li><a href="04_harjoitus_4.html#vektoriaineiston-luokittelut">Vektoriaineiston luokittelut</a></li>
<li><a href="04_harjoitus_4.html#lisätehtävä-nimiöiden-piirtäminen">Lisätehtävä: nimiöiden piirtäminen</a></li>
<li><a href="04_harjoitus_4.html#lisätehtävä-nimiöiden-sijoittaminen">Lisätehtävä: nimiöiden sijoittaminen</a></li>
</ul></li>
<li class="has-sub"><a href="05_harjoitus_5.html#harjoitus-5-digitointi">Harjoitus 5: Digitointi</a>
<ul>
<li><a href="05_harjoitus_5.html#valmistautuminen-3">Valmistautuminen</a></li>
<li><a href="05_harjoitus_5.html#muokkauksen-yleisasetukset">Muokkauksen yleisasetukset</a></li>
<li><a href="05_harjoitus_5.html#editoinnin-valmistelu">Editoinnin valmistelu</a></li>
<li><a href="05_harjoitus_5.html#geopackagen-luonti">GeoPackagen luonti</a></li>
<li><a href="05_harjoitus_5.html#aloita-geometrioiden-editointi">Aloita geometrioiden editointi</a></li>
<li><a href="05_harjoitus_5.html#lisätehtävä-1">Lisätehtävä 1</a></li>
<li><a href="05_harjoitus_5.html#lisätehtävä-2">Lisätehtävä 2</a></li>
</ul></li>
<li class="has-sub"><a href="06_harjoitus_6.html#harjoitus-6-lisäosien-asentaminen-uusien-visualisointien-hakeminen-symbolikirjastoista-ja-omien-symbolien-tekeminen">Harjoitus 6: Lisäosien asentaminen, uusien visualisointien hakeminen symbolikirjastoista ja omien symbolien tekeminen</a>
<ul>
<li><a href="06_harjoitus_6.html#harjoituksen-sisältö-3">Harjoituksen sisältö</a></li>
<li><a href="06_harjoitus_6.html#harjoituksen-tavoite-3">Harjoituksen tavoite</a></li>
<li><a href="06_harjoitus_6.html#valmistautuminen-4">Valmistautuminen</a></li>
<li><a href="06_harjoitus_6.html#lisäosien-asentaminen">Lisäosien asentaminen</a></li>
<li><a href="06_harjoitus_6.html#qgis-hub-plugin">QGIS Hub plugin</a></li>
<li><a href="06_harjoitus_6.html#qgis-resource-sharing">QGIS Resource Sharing</a></li>
<li class="has-sub"><a href="06_harjoitus_6.html#lisätehtävä-omien-symbolien-tekeminen">Lisätehtävä: Omien symbolien tekeminen</a>
<ul>
<li><a href="06_harjoitus_6.html#vinkkejä-onnistuneeseen-svg-symbolien-luontiin">Vinkkejä onnistuneeseen SVG-symbolien luontiin</a></li>
</ul></li>
</ul></li>
<li class="has-sub"><a href="07_harjoitus_7.html#harjoitus-7-karttatuloste">Harjoitus 7: Karttatuloste</a>
<ul>
<li><a href="07_harjoitus_7.html#harjoituksen-sisältö-4">Harjoituksen sisältö</a></li>
<li><a href="07_harjoitus_7.html#harjoituksen-tavoite-4">Harjoituksen tavoite</a></li>
<li><a href="07_harjoitus_7.html#valmistautuminen-5">Valmistautuminen</a></li>
<li><a href="07_harjoitus_7.html#karttatuloste">Karttatuloste</a></li>
<li><a href="07_harjoitus_7.html#lisätehtävä-kartta-atlas">Lisätehtävä: kartta-atlas</a></li>
</ul></li>
<li class="has-sub"><a href="08_harjoitus_8.html#harjoitus-8-sql-kyselyt">Harjoitus 8: SQL-kyselyt</a>
<ul>
<li><a href="08_harjoitus_8.html#harjoituksen-sisältö-5">Harjoituksen sisältö</a></li>
<li><a href="08_harjoitus_8.html#harjoituksen-tavoite-5">Harjoituksen tavoite</a></li>
<li><a href="08_harjoitus_8.html#valmistautuminen-6">Valmistautuminen</a></li>
<li><a href="08_harjoitus_8.html#tilastot">Tilastot</a></li>
<li class="has-sub"><a href="08_harjoitus_8.html#alueellisten-summien-laskeminen-ja-aggregointi">Alueellisten summien laskeminen ja aggregointi</a>
<ul>
<li><a href="08_harjoitus_8.html#aggregointi">Aggregointi</a></li>
<li><a href="08_harjoitus_8.html#alueellisten-summien-laskeminen">Alueellisten summien laskeminen</a></li>
</ul></li>
<li><a href="08_harjoitus_8.html#lisätehtävä-summien-laskeminen-sql-lausekkeilla">Lisätehtävä: Summien laskeminen SQL-lausekkeilla</a></li>
</ul></li>
</ul>
</div>
</nav>
</div>
</header>
</div>
</div>
<div class="row">
<div class="col-sm-12">
<div id="harjoitus-8-sql-kyselyt" class="section level1">
<h1>Harjoitus 8: SQL-kyselyt</h1>
<div id="harjoituksen-sisältö-5" class="section level2">
<h2>Harjoituksen sisältö</h2>
<p>Harjoituksessa harjoitellaan SQL-kyselyiden tekemistä aineistoilla</p>
</div>
<div id="harjoituksen-tavoite-5" class="section level2">
<h2>Harjoituksen tavoite</h2>
<p>Koulutettava oppii SQL-kyselyiden luonnin</p>
</div>
<div id="valmistautuminen-6" class="section level2">
<h2>Valmistautuminen</h2>
<p>Käynnistä QGIS-ohjelmisto. Avaa uusi QGIS-projekti ja tallenna se nimellä (<strong>Projekti → Tallenna nimellä…</strong>) “<strong>QGIS_harjoitus_8</strong>”.</p>
<p>Lisää projektiin seuraavat aineistot:</p>
<ul>
<li><strong>…/jv-johdot.TAB</strong></li>
<li><strong>…/kaupunginosat.TAB</strong></li>
<li><strong>…/viemäripiirit.TAB (jos haluat käyttää tätä lakusissa kaupnginosien sijaan)</strong></li>
</ul>
</div>
<div id="tilastot" class="section level2">
<h2>Tilastot</h2>
<p>Avaa projektiisi <strong>jv-johdot.TAB</strong> ja muunnetaan se harjoituksen aluksi GeoPackageksi. Tämä varmistaa sen, että saamme laskettua alueellisia summia ja tehtyä SQL-kyselyitä. Klikkaa Tasot-luettelossa jv-johdot tasoa hiiren oikealla ja valitse <strong>Vie</strong> &gt; <strong>Tallenna kohteet nimellä.</strong> Anna Tiedostomuodon olla GeoPackage. Valitse <strong>Tiedostonimeksi</strong> jvjohdot ja <strong>Tason nimeksi</strong> jvjohdot. Vaihda <strong>koordinaattijärjestelmäksi</strong> Ennalta määritelty koordinaattijärjestelmä ja valitse <strong>ETR89/GK27FIN</strong> (EPSG:3881). Tallenuksen jälkeen taso ilmestyy Tasot-paneeliin. Poista alkuperäinen jv-johdot.TAB painamalla tasoa hiiren oikealla ja valitsemalla <strong>Poista taso</strong>. Varmista vielä, että projektille on määritetty koordinaatistoksi <strong>ETR89/GK27FIN</strong> (EPSG:3881). Voit tehdä sen esim. <strong>Projekti</strong> &gt; <strong>Ominaisuudet</strong> &gt; <strong>Koordinaatijärjestelmä</strong> tai QGISin oikean alalaidan kuvakkeen kautta.</p>
<p>Tehdään vielä alkuvalmisteluina muutos ominaisuustietotauluun. Alkuperäisessä aineistossa pituustieto oli tekstimuodossa, joka estää laskuoperaatioiden tekemisen. Mene <strong>Tason ominaisuudet</strong> &gt; <strong>Tietokentät</strong> ja poista sarake <strong>Pituus</strong> aktivoimalla muokkaus kynäkuvakkeesta ja valitsemalla <strong>Poista kenttä.</strong> Paina <strong>Uusi kenttä</strong> ja anna Nimeksi Pituus ja Tyypiksi Desimaalinumero. Laske tämän jälkeen pituudet <strong>Kentän arvojen laskin -työkalulla</strong> kuten tehtiin Digitointiharjoituksessa.</p>
<p>Tutkitaan seuraavaksi tasoa QGISin tilastot-paneelissa, jossa voit tarkastella aineistosi arvojen tilastollista jakaumaa. Saat <strong>Tilastot-paneelin</strong> näkyviin QGISin käyttöliittymään klikkaamalla Näytä tilastollinen yhteenveto -painiketta <img src="img/harjoitus_8/image4.png" /> tai valitsemalla päävalikosta <strong>Näytä &gt; Paneelit &gt; Tilastot</strong>. Avautuvassa ikkunassa valitse pudotusvalikosta <strong>jvjohdot-taso</strong> ja sen jälkeen yksi tason attribuuttikenttä. Tarkastele esitettäviä tilastollisia tunnuslukuja. Voit myös valita aineistosta vain osan, jonka tilastoja haluat tarkastella. Valitse osa aineiston ruuduista joko kartalta tai attribuuttitaulusta, ja klikkaa <strong>Tilastot-paneelin</strong> ruutu <strong>Käytetään vain valittuja kohteita</strong> aktiiviseksi.</p>
<p><img src="img/harjoitus_8/image5.png" /></p>
</div>
<div id="alueellisten-summien-laskeminen-ja-aggregointi" class="section level2">
<h2>Alueellisten summien laskeminen ja aggregointi</h2>
<p>Erilaisia paikkatietoaineistoja pitää välillä yhdistää ominaisuuksiensa tai sijainnin perusteella. Tässä harjoituksessa tutustuaan, miten ominaisuustietoja voidaan yhdistää eri tavoin.</p>
<div id="aggregointi" class="section level3">
<h3>Aggregointi</h3>
<p>Valitse sopiva valintatyökalun asetus:</p>
<p><img src="img/harjoitus_8/image7.png" /></p>
<p>ja tee valintatyökaluilla valinta halutulta alueelta.</p>
<p>Aggregoimalla voidaan yhdistää sarakkeita jonkin ominaisuustiedon perusteella ja päättää, miten muut sarakkeet yhdistyvät toisiinsa. Etsi Prosessointityökaluista <strong>Aggregaatti</strong>. Valitse syötetasoksi jvjohdot, laita valintapäälle “Käytetään vain valittuja kohteita” ja ryhmittelylauseeksi <code>"TYYPPI"</code>. Kokoomat-lehdellä on kaikki aineiston sarakkeet ja voit valita miten sarakkeet yhdistyvät toisiinsa. Poista kaikki ylimääräiset sarakkeet valitsemalla esimerkiksi CTRL-pohjassa sarakkeet ja painamalla <img src="img/harjoitus_8/image18.png" /> nappia. Jätä näkyviin vain TYYPPI ja pituus. Lisää tämän jälkeen vielä toinen TYYPPI sarake. Määrittele seuraavat ryhmittelyfunktiot:</p>
<ul>
<li><p>TYYPPI –&gt; first_value</p></li>
<li><p>pituus –&gt; sum</p></li>
<li><p>TYYPPI –&gt; count</p>
<p>Vaihda tämän jälkeen vielä pituus sarakkeen nimeksi “YHTEISPITUUS” ja TYYPPI - count sarakkeen nimeksi “TYYPPIEN_lkm”</p>
<p><img src="img/harjoitus_8/image12.png" /></p></li>
</ul>
<p>Paina vielä <strong>Suorita</strong>. Ajossa kestää hetki ja uusi Aggregated-taso ilmestyy projektiisi. Avaa tason attribuuttitaulukko. Jokaisella osa-alueella on summattuna alueella olevien jvjohtojen lukumäärä tyypeittäin. Voit visualisoida aineiston esimerkiksi valitsemalla kuvaustekniikaksi porrastettu ja etsimällä aineistoon sopivat luokkavälit.</p>
</div>
<div id="alueellisten-summien-laskeminen" class="section level3">
<h3>Alueellisten summien laskeminen</h3>
<p>Harjoituksessa käytetään Kuopion kaupungin <strong>kaupunginosat</strong>- tasoa (<strong>kaupunginosat.TAB</strong>) ja lasketaan, kuinka paljon jvjohtoja on eri Kuopion osa-alueilla.</p>
<div class="hint-box">
<p>Voit myös tehdä harjoituksen myös muulla aluejaolla esimerkiksi viemäripiirit tasolla.</p>
</div>
<p>Liitetään tieto jv-johdoista Kuopion kaupunginosa jakoon sijainnin perusteella. Avaa <strong>Vektori -&gt; Tiedonhallinta -&gt; Yhdistä attribuutit sijainnin perusteella</strong>. Valitse yhdistettäväksi tasoksi kaupungingosat ja vertailukohteeksi jvjohdot. Jätä Säilytettävät kentät tyhjäksi niin kaikki jv-johdot-tason sarakkeet lisätään. Tarkista vielä, että Join type on <strong>Luo erillinen kohde jokaisesta täsmäävästä kohteesta (yksi-moneen)</strong> , jotta jokainen piste huomiodaan uudessa tasossa.</p>
<p><img src="img/harjoitus_8/image31.png" /></p>
<p>Paina <strong>Suorita</strong>. Tasoluetteloon pitäisi tulla uusi taso nimeltään “Yhdistetty taso”. Voit tarkistaa onko yhdistys tehty oikein tarkistamalla kohteiden lukumäärän. Klikkaa tasoa hiiren oikealla ja valitse “Näytä kohteiden lukumäärä” -täppä aktiiviseksi. Tee sama jvjohdot -tasolle. Jos lukumäärä on lähes sama, yhdistys on onnistunut! (muutama kohde on kaupungosa-alueiden ulkopuolella). Attribuuttitaulukossa on sarake kaikista kaupunginosista muiden attribuuttien lisäksi.</p>
<p>Seuraavaksi tasot yhdistetään osa-alueittain aggregoimalla taso kaupunginosajaon ja johdon tyypin mukaisesti. Aggregoimalla voidaan yhdistää sarakkeita jonkin ominaisuustiedon perusteella ja päättää, miten muut sarakkeet yhdistyvät toisiinsa. Etsi Prosessointityökaluista <strong>Aggregaatti</strong>. Valitse syötetasoksi aiemmin tehty Yhdistetty taso, ryhmittelylauseeksi <code>"NIMI"  || "TYYPPI"</code> (eli siis kokoamme yhteen sekä kaupunginosa nimen perusteella että johdon tyypin). Kokoomat-lehdellä on kaikki aineiston sarakkeet ja voit valita miten sarakkeet yhdistyvät toisiinsa. Poista kaikki ylimääräiset sarakkeet ja jätä näkyviin vain NIMI, pituus, TYYPPI. Lisää tämän jälkeen vielä toinen TYYPPI sarake. Määrittele seuraavat ryhmittelyfunktiot:</p>
<ul>
<li><p>NIMI –&gt; first_value</p></li>
<li><p>pituus –&gt; sum</p></li>
<li><p>TYYPPI –&gt; first_value</p></li>
<li><p>TYYPPI –&gt; count</p>
<p>Vaihda tämän jälkeen vielä pituus sarakkeen nimeksi “YHTEISPITUUS” ja TYYPPI - count sarakkeen nimeksi “TYYPPIEN_lkm”</p>
<div>
<p><img src="img/harjoitus_8/image32.png" /></p>
</div></li>
</ul>
<p>Paina vielä <strong>Suorita</strong>. Ajossa kestää hetki ja uusi Aggregated-taso ilmestyy projektiisi. Avaa tason attribuuttitaulukko. Jokaisella osa-alueella on summattuna alueella olevien jv-johtojen lukumäärä tyypeittäin. Voit visualisoida aineiston esimerkiksi valitsemalla kuvaustekniikaksi porrastettu ja etsimällä aineistoon sopivat luokkavälit.</p>
</div>
</div>
<div id="lisätehtävä-summien-laskeminen-sql-lausekkeilla" class="section level2">
<h2>Lisätehtävä: Summien laskeminen SQL-lausekkeilla</h2>
<p>QGIS mahdollistaa SQL-kyselyiden tekemisen suoraan aineistoihin, kuten PostGIS-tietokantoihin tai paikallisiin tiedostoihin (esim. GeoPackage). Tässä ohjeet, miten voit tehdä SQL-kyselyitä QGIS:llä:</p>
<p>1. <strong>Valmistaudu SQL-kyselyihin</strong></p>
<p>Tarkista, että aineisto tukee SQL-kyselyitä</p>
<ul>
<li><p><strong>PostGIS-tietokanta:</strong> Voit käyttää SQL:ää suoraan, kun olet yhdistänyt QGIS:n PostGIS-tietokantaan.</p></li>
<li><p><strong>GeoPackage-tiedosto:</strong> GeoPackage-tiedostot tukevat SQL:ää.</p></li>
<li><p><strong>Shapefile:</strong> Shapefile ei tue suoria SQL-kyselyitä; muunna se ensin sopivampaan muotoon, kuten GeoPackage.</p></li>
<li><p><strong>MapInfo-tiedostot kuten TAB:</strong> eivät tue suoria SQL-kyselyitä; muunna se ensin sopivampaan muotoon, kuten GeoPackage.</p></li>
</ul>
<p>2. <strong>Avaa Tietokannan hallinta (“DB Manager”)</strong></p>
<p>DB Manager on QGIS:n työkalu, jonka avulla voit tehdä SQL-kyselyitä:</p>
<ol style="list-style-type: decimal">
<li><p>Avaa <strong>Tietokannan hallinta</strong> (<strong>DB Manager)</strong>:</p>
<ul>
<li><strong>Valikko:</strong> <em>Tietokanta -&gt; Tietokannan hallinta</em>.</li>
</ul></li>
<li><p>Valitse tietolähde:</p>
<ul>
<li>Jos käytät GeoPackage-tiedostoa, valitse tiedosto paikallisista tietolähteistä.</li>
</ul></li>
</ol>
<p>3. <strong>Kirjoita SQL-kysely</strong></p>
<ul>
<li><p>Klikkaa tietokannan nimeä ja valitse <strong>SQL-kysely</strong> (Query).</p></li>
<li><p>Kirjoita SQL-koodi editoriin:</p>
<div class="code-box">
<p>SELECT geom, sum(ST_Length(geom)) AS kokonaispituus</p>
<p>FROM jvjohdot;</p>
</div>
<p><img src="img/harjoitus_8/image34.png" /></p></li>
</ul>
<!-- -->
<ul>
<li><p>Suorita kysely:</p>
<ul>
<li>Klikkaa <strong>Suorita kysely (Execute)</strong>.</li>
</ul></li>
<li><p>Tässä myös muita SQL-lauseita:</p></li>
</ul>
<p>Lukumäärien laskenta:</p>
<div class="code-box">
<p>SELECT TYYPPI, COUNT(*) AS lukumäärä</p>
<p>FROM jvjohdot</p>
<p>GROUP BY TYYPPI;</p>
</div>
<p>Lukumäärät, josta betoni materiaali ja omistaja Kuopion Vesi:</p>
<div class="code-box">
<p>SELECT TYYPPI, COUNT(*) AS lukumäärä</p>
<p>FROM jvjohdot</p>
<p>where OMISTAJA IS “Kuopion Vesi” AND MATERIAALI IS “BET”</p>
<p>GROUP BY TYYPPI;</p>
</div>
<p><strong>SQL-kyselyt suoraan QGIS:n tasoille</strong></p>
<p>Jos haluat tehdä SQL-kyselyitä ilman DB Manageria, voit käyttää <strong>suodattimia</strong></p>
<p><strong>a) Käytä Suodatinta (Filter):</strong></p>
<ol style="list-style-type: decimal">
<li><p>Valitse taso, jolle haluat tehdä kyselyn ja klikkaa sitä hiiren oikealla → <strong>Suodatin</strong>.</p></li>
<li><p>Kirjoita yksinkertainen kysely, esimerkiksi:</p>
<div class="code-box">
<p>“TYYPPI” = ‘Keräilyviemäri, digit. - Jäte’</p>
</div>
<p>TAI:</p>
<div class="code-box">
<p>“TYYPPI” = ‘Keräilyviemäri, digit. - Jäte’ AND “OMISTAJA” = ‘Kuopion Vesi’</p>
</div></li>
<li><p>Klikkaa <strong>OK</strong>.</p></li>
</ol>
<p><strong>Hyviä käytäntöjä SQL-kyselyissä</strong></p>
<ul>
<li><p><strong>Projektio:</strong> Varmista, että käytät oikeita koordinaattijärjestelmiä erityisesti geometriakyselyissä.</p></li>
<li><p><strong>Optimoitu kysely:</strong> Suuren tietoaineiston käsittely voi olla hidasta, joten käytä suodattimia (esim. <code>WHERE</code>) tarpeettomien rivien rajaamiseksi.</p></li>
<li><p><strong>Testaa kyselyt pienemmässä mittakaavassa:</strong> Varmista, että kysely toimii ennen kuin suoritat sen koko tietoaineistolle.</p></li>
</ul>

</div>
</div>
<p style="text-align: center;">
<a href="07_harjoitus_7.html"><button class="btn btn-default">Previous</button></a>
</p>
</div>
</div>

<footer class="footer text-center">

<div class="footer-container text-center">

<div class="footer-info">
<h5 class="footer-title">QGIS-koulutus Kuopion vedelle</h5>
<span class="footer-version">v2025-10-31</span>
<div class="license"><img src="img/by-nd.svg" width="80px" alt="CC-BY-ND"></div>
</div>

<div class="footer-info">
<h5 class="footer-title footer-company">Gispo Suomi Oy.
<span class="footer-copyright-year">© 2025</span></h5>
<span class="footer-contact-info">Kyllikinportti 2
<br>00240 Helsinki, Finland
<br>info@gispo.fi
</span>
</div>

</div>
</div>
</footer>
</div>


<script src="js/nav-script.js"></script>
<script src="js/answer-key.js"></script>

</body>
</html>
