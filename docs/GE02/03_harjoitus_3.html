<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

<link rel="icon" href="/master-training-data/favicon.ico" type="image/x-icon">
<link rel="shortcut icon" href="/master-training-data/favicon.ico" type="image/x-icon">

<!-- Based on TemplateMo 553 Xtra Blog: https://templatemo.com/tm-553-xtra-blog -->

<meta name="robots" content="noindex, nofollow" />
<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta property="og:title" content="Harjoitus 3: Relaatiot | QGIS kaavoittajille" />
<meta property="og:type" content="book" />





<meta name="author" content="Gispo Oy." />

<meta name="date" content="2024-01-18" />


<meta name="description" content="Harjoitus 3: Relaatiot | QGIS kaavoittajille">

<title>Harjoitus 3: Relaatiot | QGIS kaavoittajille</title>




<link rel="stylesheet" href="custom.css" type="text/css" />

<link href="css/bootstrap.min.css" rel="stylesheet">
<link href="css/hamburgers.css" rel="stylesheet">

</head>

<body>


<div class="main-content">
<!-- special comment to mark beginning of title section for bookdown -->
<!-- bookdown comments must be in this order: title, toc, body -->

<div class="main-content-wrapper">

<div class="row">
<div class="col-sm-12">
<header class="main-toc sidebar" id="sidebar">
<div class="sidebar-wrapper">

<button class="navbar-toggle hamburger hamburger--collapse" id="navbar-toggle"
type="button" onclick="navToggle()" aria-label="Toggle navigation">
<span class="hamburger-box"><span class="hamburger-inner"></span></span>
</button>

<div class="sidebar-title-wrapper">
<img alt="Logo" width="100" src="img/gispo_white_sm.png" class="sidebar-logo">
<div class="sidebar-title"><h1>QGIS kaavoittajille</h1></div>
<div class="abstract-sidebar"><p>QGIS jatkokurssi kaavoittajille.</p></div>
</div>

<nav class="sidebar-nav">
<div id="TOC" class="toc">
<ul>
<li class="has-sub"><a href="index.html#template">Template</a>
<ul>
<li><a href="index.html#tervetuloa-kurssille">Tervetuloa kurssille!</a></li>
<li><a href="index.html#lukuohje">Lukuohje</a></li>
<li><a href="index.html#mistä-lisätietoja">Mistä lisätietoja?</a></li>
<li><a href="index.html#virheet">Virheet</a></li>
<li><a href="index.html#lisenssi-ja-oikeudet">Lisenssi ja oikeudet</a></li>
</ul></li>
<li class="has-sub"><a href="01_harjoitus_1.html#harjoitus-1-digitoinnin-perusteet">Harjoitus 1: Digitoinnin perusteet</a>
<ul>
<li><a href="01_harjoitus_1.html#valmistautuminen"><strong>Valmistautuminen</strong></a></li>
<li><a href="01_harjoitus_1.html#muokkauksen-yleisasetukset"><strong>Muokkauksen yleisasetukset</strong></a></li>
<li><a href="01_harjoitus_1.html#editoinnin-valmistelu"><strong>Editoinnin valmistelu</strong></a></li>
<li><a href="01_harjoitus_1.html#geopackagen-luonti"><strong>GeoPackagen luonti</strong></a></li>
<li><a href="01_harjoitus_1.html#aloita-geometrioiden-editointi"><strong>Aloita geometrioiden editointi</strong></a></li>
</ul></li>
<li class="has-sub"><a href="02_harjoitus_2.html#harjoitus-2-edistyneet-digitointiominaisuudet">Harjoitus 2: Edistyneet digitointiominaisuudet</a>
<ul>
<li><a href="02_harjoitus_2.html#valmistautuminen-1"><strong>Valmistautuminen</strong></a></li>
<li><a href="02_harjoitus_2.html#edistyneen-digitoinnin-ominaisuudet"><strong>Edistyneen digitoinnin ominaisuudet</strong></a></li>
<li><a href="02_harjoitus_2.html#negatiivinen-vyöhyke"><strong>Negatiivinen vyöhyke</strong></a></li>
<li><a href="02_harjoitus_2.html#kohteiden-editoiminen-alkuperäisessä-tiedostossa"><strong>Kohteiden editoiminen alkuperäisessä tiedostossa</strong></a></li>
<li><a href="02_harjoitus_2.html#kohteisiin-tarttuminen-snapping-ja-rakennustila-construction-mode"><strong>Kohteisiin tarttuminen (snapping) ja rakennustila (construction mode)</strong></a></li>
</ul></li>
<li class="has-sub"><a href="03_harjoitus_3.html#harjoitus-3-relaatiot">Harjoitus 3: Relaatiot</a>
<ul>
<li><a href="03_harjoitus_3.html#valmistautuminen-2"><strong>Valmistautuminen</strong></a></li>
<li><a href="03_harjoitus_3.html#aineistojen-valmistelu"><strong>Aineistojen valmistelu</strong></a></li>
<li><a href="03_harjoitus_3.html#editointi-relaatioita-hyödyntämällä"><strong>Editointi relaatioita hyödyntämällä</strong></a></li>
<li><a href="03_harjoitus_3.html#relaatioiden-sisäiset-säännöt"><strong>Relaatioiden sisäiset säännöt</strong></a></li>
<li><a href="03_harjoitus_3.html#lisätehtävä-automaattisesti-täydentyvät-arvot"><strong>Lisätehtävä: automaattisesti täydentyvät arvot</strong></a></li>
</ul></li>
<li class="has-sub"><a href="04_harjoitus_4.html#harjoitus-4-topologia-ja-geometria">Harjoitus 4: Topologia ja geometria</a>
<ul>
<li><a href="04_harjoitus_4.html#valmistautuminen-3"><strong>Valmistautuminen</strong></a></li>
<li><a href="04_harjoitus_4.html#virheellisen-aineiston-tuonti-qgisiin"><strong>Virheellisen aineiston tuonti QGISiin</strong></a></li>
<li><a href="04_harjoitus_4.html#tarkista-kelpoisuus-check-validity"><strong>Tarkista kelpoisuus (Check validity)</strong></a></li>
<li><a href="04_harjoitus_4.html#topologian-tarkastaja-topology-checker"><strong>Topologian tarkastaja (Topology checker)</strong></a></li>
<li><a href="04_harjoitus_4.html#tarkista-geometriat-geometry-checker"><strong>Tarkista geometriat (Geometry checker)</strong></a></li>
<li><a href="04_harjoitus_4.html#geometrian-ja-topologian-validointi-tasoa-muokattaessa"><strong>Geometrian ja topologian validointi tasoa muokattaessa</strong></a></li>
</ul></li>
<li class="has-sub"><a href="05_harjoitus_5.html#harjoitus-5-geokoodaus">Harjoitus 5: Geokoodaus</a>
<ul>
<li><a href="05_harjoitus_5.html#valmistautuminen-4"><strong>Valmistautuminen</strong></a></li>
<li><a href="05_harjoitus_5.html#geocoding--lisäosa"><strong>GeoCoding -lisäosa</strong></a></li>
<li><a href="05_harjoitus_5.html#digitransit.fi-geocoder"><strong>DigiTransit.fi Geocoder</strong></a></li>
</ul></li>
</ul>
</div>
</nav>
</div>
</header>
</div>
</div>
<div class="row">
<div class="col-sm-12">
<div id="harjoitus-3-relaatiot" class="section level1">
<h1>Harjoitus 3: Relaatiot</h1>
<p><strong>Harjoituksen sisältö</strong></p>
<p>Harjoituksessa opetellaan hyödyntämään ulkopuolisia tauluja aineiston editoinnissa.</p>
<p><strong>Harjoituksen tavoite</strong></p>
<p>Harjoituksen jälkeen osallistuja osaa hyödyntää tehokkaasti QGISin Attribute Forms toiminnallisuutta ominaisuustietojen editoinnissa.</p>
<p><strong>Arvioitu kesto</strong></p>
<p>30 minuuttia.</p>
<div id="valmistautuminen-2" class="section level2">
<h2><strong>Valmistautuminen</strong></h2>
<p>Avaa uusi QGIS-projekti (<strong>Projekti &gt; Uusi</strong>) ja tallenna se nimellä "<strong>QGIS-harjoitus 3</strong>". Lisää projektiin seuraavat aineistot:</p>
<ul>
<li><p><strong>OpenStreetMap</strong></p></li>
<li><p><strong>Luokat.gpkg (luokitus_taso_1, luokitus_taso_2, luokitus_taso_3)</strong></p></li>
<li><p><strong>Loppi.gpkg</strong></p></li>
</ul>
</div>
<div id="aineistojen-valmistelu" class="section level2">
<h2><strong>Aineistojen valmistelu</strong></h2>
<p>GeoPackage-tietokantaan voi lisätä myös tasoja/tiedostoja/aineistoja, jotka eivät sisällä lainkaan geometrioita – käytännössä QGISiin avautuu silloin kuinkin kohteen attribuuttitaulut. Projektiin avatut <strong>Luokat-GeoPackagen</strong> sisältämät tasot ovat juuri tällaisia aineistoja, joilla ei ole geometriaa. <strong>Luokat-aineisto</strong> sisältää kolmiportaisen maankäyttöluokitusjärjestelmän, joka perustuu <a href="https://www.stat.fi/meta/luokitukset/maankaytto/001-2000-05-01/kuvaus.html">SLICES</a>-luokitukseen. Avaa kunkin tason attribuuttitaulut ja tarkastele niiden sisältöä.</p>
<p><img src="img/harjoitus_3/image1.png" /></p>
<p>Luokittelu on hierarkinen ja logiikka on helppo ymmärtää:</p>
<ul>
<li><p>Jokaisella maankäyttöluokalla on oma koodinsa, jonka pituus riippuu hierarkian tasosta</p></li>
<li><p>Jokaisella luokalla on myös sanallinen kuvaus luokasta</p></li>
</ul>
<p>Editoinnin tarkoituksena on hyödyntää ja rajoittaa luokkien välisiä suhteita attribuuttitietojen editoinnissa. Tehdään maankäytön suunnitelma näillä luokituksilla, joka perustuu kuusikulmioihin. Useassa kaupungissa on luotu yleiskaavoja, joissa kerrotaan ruuduittain alueiden käytön suunnittelusta. Harjoituksessa luomme kuvitteellisen yleiskaavan Lopelle Kanta-Hämeeseen heksagonien avulla.</p>
<p><img src="img/harjoitus_3/image2.png" /></p>
<p>Seuraavaksi luomme koko kunnan alueen kattavan kuusikulmioaineiston. Valitse <strong>Prosessointityökalut-paneelista Vektoritiedon luonti &gt; Luo ruudukko</strong>. Täytä avautuva Luo ruudukko -ikkunan tiedot seuraavan kuvan mukaisesti:</p>
<p><img src="img/harjoitus_3/image3.png" /></p>
<p>Valitse <strong>Ruudukon laajuus -kohdassa … &gt; Valitse laajuus piirtoalueelta</strong>, jonka jälkeen QGIS pyytää sinua valitsemaan kursorilla alueen jolle ruudukko muodostetaan.</p>
<p><img src="img/harjoitus_3/image4.png" /></p>
<p>Jätä <strong>tyhjäksi tallennussijainti</strong> kohta, jolloin tiedosto tallentuu väliaikaiseksi tiedostoksi nimellä <strong>Ruudukko</strong>. Kun klikkaat <strong>Suorita</strong>, QGIS luo heksagoniruudukon valitsemallesi alueelle.</p>
<p><img src="img/harjoitus_3/image5.png" />
Kun ruudukko on luotu, valikoimme siitä vain Loppi-polygonin kohdalle osuvat ruudut. Tämä tehdään <strong>Prosessointityökalut-paneelista Vektoritiedosta poiminta &gt; Irrota sijainnin perusteella -työkalulla</strong>. Valitse Irrota tasolta kohtaan äsken luotu väliaikainen-tasosta <strong>Ruudukko</strong> ja valitse ne kohteet, jotka leikkaavat. Valitse tallennussijainniksi <strong>Loppi.gpkg</strong> ja anna tason nimeksi <strong>Loppi_ruudukko</strong> ja klikkaa <strong>Suorita</strong>.</p>
<p><img src="img/harjoitus_3/image6.png" /></p>
<p><img src="img/harjoitus_3/image9.png" /></p>
<p>Seuraavaksi lisäämme tasoon uudet attribuuttitietokentät, jotka kertovat kyseisen tason maankäytöstä. Seuraamme luokituksessa SLICES-luokitusta, jonka luemme toisesta taulusta. Luokittelu on kolmiportainen, joten ensimmäisenä luomme ominaisuustietokentän nimeltä <strong>"Taso_1"</strong> <strong>Loppi_ruudukko-tason</strong> attribuuttitauluun. Avaa ruudukko-tason attribuuttitaulu klikkaamalla <strong>Avaa attribuuttitaulu -kuvaketta</strong> <img src="img/harjoitus_3/image10.png" /> <strong>Ominaisuustietojen työkalupalkista</strong> tai klikkaamalla tasoa hiiren oikealla painikkeella ja valitsemalla <strong>Avaa attribuuttitaulu</strong>. Luo uusi kenttä klikkaamalla <strong>Uusi kenttä -kuvaketta</strong> <img src="img/harjoitus_3/image11.png" /> attribuuttitaulussa.</p>
<p><img src="img/harjoitus_3/image12.png" /></p>
<p>Lisää samalla tavalla myös kentät "Taso_2" ja "Taso_3". Nyt sinulla on suunnitelman pohja valmiina.</p>
</div>
<div id="editointi-relaatioita-hyödyntämällä" class="section level2">
<h2><strong>Editointi relaatioita hyödyntämällä</strong></h2>
<p>Lähdetään tutkimaan luodun tason <strong>attribuuttilomaketta</strong>. Klikkaa tason päällä hiiren oikeaa painiketta ja valitse <strong>Ominaisuudet… &gt; Attribuuttilomake</strong>. Tehdään ensin muista kuin kolmesta luomastamme kentästä sellaisia, ettei niitä pysty muokkaamaan. Tämä tehdään poistamalla rasti <strong>Muokattava-kohdasta</strong>.</p>
<p><img src="img/harjoitus_3/image13.png" /></p>
<p>Siirry seuraavaksi tehtyjen luokitusten kenttiin. Valitse Taso_1-kentän muokkauksen tyypiksi <strong>Arvojen suhde</strong> ja aseta määritykset seuraavan kuvan mukaisesti:</p>
<p><img src="img/harjoitus_3/image14.png" /></p>
<p>Lisää samalla tavalla myös relaatiot kentille <strong>Taso_2</strong> ja <strong>Taso_3</strong>, mutta muuta <strong>Taso-kohtaan</strong> oikea luokitustaso (2 ja 3). Paina sitten <strong>OK</strong>.</p>
<p>Valitse nyt kartalta useampi ruutu ja klikkaa sitten <strong>Muokkaa samalla kaikkien valittujen kohteiden attribuutteja -kuvaketta</strong> <img src="img/harjoitus_3/image15.png" />. Pääset nyt valitsemaan alasvetovalikosta oikeita luokkia näihin ruudukoihin.</p>
<p><img src="img/harjoitus_3/image16.png" /></p>
<p>Käytännössä saat siis oikeat arvot kenttiin kirjoittamatta niitä manuaalisesti. Kuitenkin tässä tapauksessa käyttäjän on vielä mahdollista tehdä ns. vääriä valintoja, eli on mahdollista että valitset ylemmästä luokasta jonkun, joka ei vastaa alemman luokan määrityksiä. Valitse kuitenkin kaikille valituille ruuduille jokin pääluokka.</p>
</div>
<div id="relaatioiden-sisäiset-säännöt" class="section level2">
<h2><strong>Relaatioiden sisäiset säännöt</strong></h2>
<p>Asetetaan nyt säännöt, jonka mukaan relaatiot riippuvat lomakkeen täytössä tehdyistä valinnoista. Mene uudestaan tason <strong>Attribuuttilomakkeeseen</strong> ja valitsemaasi tason ominaisuuskenttään (Taso_1, Taso_2 tai Taso_3). Syötä Taso_2 -kentän <strong>Suodatinlauseke-kenttään</strong> seuraava lauseke:</p>
<div class="code-box">
<p>left(“koodi”,1)=current_value(‘Taso_1’)</p>
</div>
<p><img src="img/harjoitus_3/image17.png" /></p>
<p>Käytännössä tämä määrittää rajoituksen, jonka mukaan lomakkeella näytetään ainoastaan sellaisia kohteita, joiden koodi vastaa ylemmän tason määritystä. Tee samalla logiikalla määritykset tasolle 3, mutta muuta lausekkeen numerot 1 numeroiksi 2. Mene nyt <strong>Loppi_ruudukko-tasolle</strong> ja yritä luoda kokonaan uusi geometria. Jos määritykset toimivat, editointi ei anna nyt käyttäjän syöttää vääriä tietoja!</p>
<p><img src="img/harjoitus_3/image18.png" /></p>
</div>
<div id="lisätehtävä-automaattisesti-täydentyvät-arvot" class="section level2">
<h2><strong>Lisätehtävä: automaattisesti täydentyvät arvot</strong></h2>
<p><strong>Attribuuttilomake</strong>-välilehden avulla voit myös asettaa lausekkeita, joiden avulla kenttien arvot täydentyvät automaattisesti. Lauseke annetaan välilehden alaosan <strong>Oletusarvo</strong> -kohdassa.</p>
<p><img src="img/harjoitus_3/image19.png" /></p>
<p>Asetetaan nyt oletusarvot siten, että käyttäjän valitessa suoraan sopivan maankäyttöluokan tasolla 3, tasojen 1 ja 2 arvot täydentyvät automaattisesti vastaaviksi. Huomaa, että jos käytät oletusarvoja, edellisessä tehtävässä tehdyt suodatuslausekeet eivät toimi yhtäaikaisesti oletusarvojen kanssa. Ne on siis ensin poistettava.</p>
<p>Tasolla 3 ei anneta mitään suodatuslauseketta eikä myöskään oletusarvoa. Tasolle 2 asetetaan oletusarvo-kohtaan lauseke siten, että se poimii Taso_3-kentän nykyisestä arvosta kaksi vasemmanpuoleisinta merkkiä ja kirjoittaa saamansa tuloksen Taso_2 -kenttään.</p>
<div class="code-box">
<p>left(attribute($currentfeature, ‘Taso_3’),2)</p>
</div>
<p>Ruksi myös <strong>Käytä oletusarvoa päivityksessä</strong> -kohta.</p>
<p>Vastaavasti Taso_1:n oletusarvoksi asetetaan yhden vasemmanpuoleisimman merkin poiminta Taso_3-kentästä.</p>
<p><img src="img/harjoitus_3/image20.png" /></p>
<p>Testaa lausekkeiden toimivuutta editoimalla muutaman kuusikulmion ominaisuustietoja: valitse Taso_3-kentässä haluamasi maanäyttöluokka ja tarkista, että kentät Taso_1 ja Taso_2 päivittyvät. </p>
<p><img src="img/harjoitus_3/image21.png" /></p>
<p>Muita hyödyllisiä käyttötarjoituksia <strong>oletusarvo</strong> -toiminnolle on mm. kohteen editointihetken tallentaminen komennolla <strong>now()</strong> sekä kohteen luojan tai editoijan käyttäjätunnuksen tallentaminen komennolla <strong>user_account_name</strong>.</p>
<p>Kun olet valmis, tallenna projektitiedosto kurssihakemistoon pikanäppäimellä <strong>CTRL + T</strong> (englanninkielisessä QGISissä <strong>CTRL + S</strong>) tai päävalikosta <strong>Projekti &gt; Tallenna</strong>.</p>
<div class="hint-box">
<p>Psst! Muista tukipalvelu! Koulutuksen jälkeen saat henkilökohtaista tukea Gispon tukipalvelun kautta lähettämällä yksinkertaisesti tuki@gispo.fi-sähköpostiosoitteeseen kysymyksen tai kommentin jostakin sinua mietityttävästä asiasta. Gispon tiimi auttaa sinua toimiesi äärellä. Kysymykset käsitellään henkilökohtaisesti.</p>
</div>

</div>
</div>
<p style="text-align: center;">
<a href="02_harjoitus_2.html"><button class="btn btn-default">Previous</button></a>
<a href="04_harjoitus_4.html"><button class="btn btn-default">Next</button></a>
</p>
</div>
</div>

<footer class="footer text-center">

<div class="footer-container text-center">

<div class="footer-info">
<h5 class="footer-title">QGIS kaavoittajille</h5>
<span class="footer-version">v2024-01-18</span>
<div class="license"><img src="img/by-nd.svg" width="80px" alt="CC-BY-ND"></div>
</div>

<div class="footer-info">
<h5 class="footer-title footer-company">Gispo Oy.
<span class="footer-copyright-year">© 2024</span></h5>
<span class="footer-contact-info">Kumpulantie 3, 3 krs
<br>00520 Helsinki, Finland
<br>info@gispo.fi
</span>
</div>

</div>
</div>
</footer>
</div>


<script src="js/nav-script.js"></script>
<script src="js/answer-key.js"></script>

</body>
</html>
